---
title: "Term Project"
author: "Nehemya McCarter-Ribakoff"
date: "April 20, 2017"
output:
  pdf_document: default
  highlight: pygments
  html_document: null
  fig_height: 4
  theme: spacelab
---

```{r setup, include=FALSE}
# DO NOT ALTER CODE IN THIS CHUNK
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)

```

* * *

```{r}
park.names = read.table("parks.csv", header = TRUE, sep = ",", quote="\"'", dec=".")
species = read.csv("species.csv", header = TRUE, sep = ",")
```

Let's remove dimensions we likely won't get much use out of:

```{r}
species = subset(species, select = -c(Scientific.Name, Common.Names, Species.ID, Record.Status))
```

And create a dataframe with everything we'll need, with features to be added:

```{r}
frequencies.df = data.frame(park.names$Park.Name, park.names$State, park.names$Acres, park.names$Latitude, "Vascular.Plant.Freq", "Bird.Freq", "Insect.Freq", "Fungi.Freq", "Nonvasc.Plant.Freq", "Fish.Freq", "Mammal.Freq", "Intervebrate.Freq", "Reptile.Freq", "Algae.Freq", "Slug/Snail.Freq", "Spider/Scorpion.Freq", "Ambphibian.Freq", "Crustacean.Freq")
colnames(frequencies.df) = c("Park.Name", "State", "Acres", "Latitude", "Vascular.Plant.Freq", "Brid.Freq", "Insect.Freq", "Fungi.Freq", "Nonvasc.Plant.Freq", "Fish.Freq", "Mammal.Freq", "Intervebrate.Freq", "Reptile.Freq", "Algae.Freq", "SlugSnail.Freq", "SpiderScorpion.Freq", "Ambhipian.Freq", "Crustacean.Freq")

frequencies.df[, 5:18] = 0
```

A function to populate our frequency table

```{r}
# Values produced by this function have been verified with table(species$Category)

categoryFreq = function(old.frequencies.df) {
  parkIndex = 1
  parkName = old.frequencies.df[1, parkIndex]
  numParks = c(1:56)
  frequencyColumns = c(5:18)
  categories = c("Vascular Plant", "Bird", "Insect", "Fungi", "Nonvascular Plant", "Fish", "Mammal", "Invertebrate", "Reptile", "Algae", "Slug/Snail", "Spider/Scorpion", "Amphibian", "Crab/Lobster/Shrimp")
  for(parkIndex in numParks) {
    parkName = old.frequencies.df[parkIndex, 1]
    temp.data = subset(species, species$Park.Name == parkName)
    for(currentFrequency in frequencyColumns) {
      category = categories[currentFrequency - 4]
      old.frequencies.df[parkIndex, currentFrequency] = sum(temp.data$Category == category)
    }
  }

  new.frequencies.df = old.frequencies.df

  return(new.frequencies.df)
}
```

Running the function:

```{r}
frequencies.df = categoryFreq(frequencies.df)
```

We create a subset data frame for clustering with only quantitative vectors

```{r}
freqs.only = subset(frequencies.df, select = -c(Park.Name, State))
```

Let's try some k-means clustering with an arbitrary k

```{r}
kmeans.out = kmeans(freqs.only, 5, nstart = 50)
plot(freqs.only, col = (kmeans.out$cluster + 1))
```

Let's take a closer look at some of the more interesting plots

Plants vs Insects
```{r}
plants.insects = data.frame(freqs.only$Vascular.Plant.Freq, freqs.only$Insect.Freq)
kmeans.out = kmeans(plants.insects, 5, nstart = 50)
plot(plants.insects, col=(kmeans.out$cluster + 1))
```

Latitude and Fungi

Hierarchical clustering

```{r}
latitude.fungi= data.frame(freqs.only$Latitude, freqs.only$Fungi.Freq)
rownames(latitude.fungi) = frequencies.df$Park.Name
# Normalize data to use euclidean distance
latitude.fungi.normal = scale(latitude.fungi)
hclust.complete = hclust(dist(latitude.fungi.normal), method = "complete")
hclust.avg = hclust(dist(latitude.fungi.normal), method = "average")
hclust.single = hclust(dist(latitude.fungi.normal), method = "single")
plot(hclust.complete, main = "Complete Linkage: Latitude and Fungi", xlab = "", sub = "", cex = .9)
plot(hclust.avg, main = "Average Linkage: Latitude and Fungi", xlab = "", sub = "", cex = .9)
plot(hclust.single, main = "Single Linkage: Latitude and Fungi", xlab = "", sub = "", cex = .9)
```

K-means clustering

```{r}
kmeans.out = kmeans(latitude.fungi.normal, 3, nstart = 50)
cluster::clusplot(latitude.fungi.normal, kmeans.out$cluster, color = TRUE, main = "Latitude and Fungi", xlab = "Latitude", ylab = "Fungi")
legend("bottomright", legend = paste("Cluster", 1:3), pch=1:3, col=1:3)
```

Let's get the vector of cluster names and their assigned cluster

```{r}
cluster.assignments = cbind(latitude.fungi.normal, kmeans.out$cluster)
colnames(cluster.assignments) = c("Latitude", "Fungi Frequency", "Cluster")
# convert from vector to data frame
cluster.assignments = as.data.frame(cluster.assignments)
# sort by cluster assignment, in ascending order
#cluster.assignments[with(cluster.assignments, order(Cluster)), ]

# Create independent data frames for each cluster
cluster.one = subset(cluster.assignments, Cluster == 1)
cluster.two = subset(cluster.assignments, Cluster == 2)
cluster.three = subset(cluster.assignments, Cluster == 3)

# Compare latitudes
summary(cluster.one)
summary(cluster.two)
summary(cluster.three)
```

Our set consists primarily of vascular plants, with relatively large proportions of birds and instects as well.

Hierarchical clustering

```{r}
hclust.complete = hclust(dist(vasc.plants.latitude.scale), method = "complete")
hclust.avg = hclust(dist(vasc.plants.latitude.scale), method = "average")
hclust.single = hclust(dist(vasc.plants.latitude.scale), method = "single")
plot(hclust.complete, main = "Complete Linkage: Latitude and Vascular Plants", xlab = "", sub = "", cex = .9)
plot(hclust.avg, main = "Average Linkage: Latitude and Vascular Plants", xlab = "", sub = "", cex = .9)
plot(hclust.single, main = "Single Linkage: Latitude and Vascular Plants", xlab = "", sub = "", cex = .9)
```

k = 4 initially seemed like a reasonable assignment. However, clusters 2 and 3 were very close to one another. k = 5 resulted in more distinct clusters

```{r}
vasc.plants.latitude = data.frame(freqs.only$Latitude, freqs.only$Vascular.Plant.Freq)
rownames(vasc.plants.latitude) = frequencies.df$Park.Name
set.seed(1)
vasc.plants.latitude.scale = scale(vasc.plants.latitude)
kmeans.out = kmeans(vasc.plants.latitude.scale, 5, nstart = 50)
cluster::clusplot(vasc.plants.latitude.scale, kmeans.out$cluster, main = "Latitude and Vascular Plants", col.p = kmeans.out$cluster, xlab = "Latitude", ylab = "Vascular Plants")
legend("topleft", legend = paste("Cluster", 1:5), pch=1:5, col=1:5)

```

Let's use hierarchical clustering to help us decide how many clusters we'll use on a comparison of vascular and nonvascular plants

```{r}
plants = data.frame(freqs.only$Vascular.Plant.Freq, freqs.only$Nonvasc.Plant.Freq)
rownames(plants) = frequencies.df$Park.Name
plants.scale = scale(plants)
hclust.complete = hclust(dist(plants.scale), method = "complete")
hclust.avg = hclust(dist(plants.scale), method = "average")
hclust.single = hclust(dist(plants.scale), method = "single")
plot(hclust.complete, main = "Complete Linkage", xlab = "", sub = "", cex = .9)
plot(hclust.avg, main = "Average Linkage", xlab = "", sub = "", cex = .9)
plot(hclust.single, main = "Single Linkage", xlab = "", sub = "", cex = .9)
counts = sapply(2:6,function(ncl)table(cutree(hclust.complete,ncl)))
```

Let's try 3

```{r}
set.seed(1)
kmeans.out = kmeans(plants.scale, 3, nstart = 50)
cluster::clusplot(plants.scale, kmeans.out$cluster, main = "Vascular and Nonvascular Plants", col.p = kmeans.out$cluster, xlab = "Vascular Plants", ylab = "Nonvascular Plants")
legend("bottomright", legend = paste("Cluster", 1:3), pch=1:3, col=1:3)

```


